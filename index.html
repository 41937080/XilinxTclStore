<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="Xilinxtclstore : Xilinx Tcl Store" />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Xilinxtclstore</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/Xilinx/XilinxTclStore">View on GitHub</a>

          <h1 id="project_title">Xilinxtclstore</h1>
          <h2 id="project_tagline">Xilinx Tcl Store</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/Xilinx/XilinxTclStore/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/Xilinx/XilinxTclStore/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>
<a name="xilinxtclstore" class="anchor" href="#xilinxtclstore"><span class="octicon octicon-link"></span></a>XilinxTclStore</h1>

<h2>
<a name="as-a-contributor" class="anchor" href="#as-a-contributor"><span class="octicon octicon-link"></span></a>As a Contributor</h2>

<ol>
<li>Get git account &lt;USER&gt; and download git on your machine</li>
<li>Ask for permission to XilinxTclStore repository by sending e-mail to <a href="mailto:tclstore@xilinx.com">tclstore@xilinx.com</a>
</li>
<li>Sign on to github.com</li>
<li>Switch to Xilinx at upper left side by your account name &lt;USER&gt;</li>
<li>Switch to GitShell on your machine</li>
</ol><h3>
<a name="checkout-the-repository" class="anchor" href="#checkout-the-repository"><span class="octicon octicon-link"></span></a>Checkout the Repository</h3>

<p>If you have already cloned the repository then skip this step. Otherwise to pull this repository from within a firewall you will need to congifure http.proxy.  Note this setting may be different for your system.  If you have questions contact your IT network administrator:</p>

<div class="highlight highlight-bash"><pre>git config --global http.proxy http://proxy:80
</pre></div>

<h3>
<a name="setting-up-user-name-and-email" class="anchor" href="#setting-up-user-name-and-email"><span class="octicon octicon-link"></span></a>Setting up User Name and Email</h3>

<div class="highlight highlight-bash"><pre><span class="c">#Create and cd to a working directory, for instance ~/github/</span>
mkdir &lt;WORKING_DIR&gt;
<span class="nb">cd</span> &lt;WORKING_DIR&gt;
git config --golbal USER.name &lt;USER&gt;  <span class="c">#github USER name</span>
git config --global USER.email your_email@your_company.com
</pre></div>

<ol>
<li>Clone the repository</li>
</ol><p>We recommend working off of only the master branches for simplicity.  We do support forking of repositories, which require syncing and merging.  If you are familiar with this methodology you can use it, otherwise stick with working off the master branches of each repo.  You need to clone the Xilinx master repo to your local area.  Don't foget to substitute &lt;USER&gt; for your real github account name:</p>

<p>On Windows</p>

<div class="highlight highlight-bash"><pre><span class="nb">cd</span> &lt;WORKING_DIR&gt;
git clone https://github.com/Xilinx/XilinxTclStore.git
</pre></div>

<p>On Linux</p>

<div class="highlight highlight-bash"><pre><span class="nb">cd</span> &lt;WORKING_DIR&gt;
git clone http://&lt;USER&gt;@github.com/Xilinx/XilinxTclStore.git
</pre></div>

<p>You will need to enter your github password when prompted.</p>

<p>Now you have cloned the repo directories under "&lt;WORKING_DIR&gt;/XilinxTclStore"</p>

<p>cd &lt;WORKING_DIR&gt;/XilinxTclStore</p>

<div class="highlight highlight-bash"><pre>git status
</pre></div>

<ol>
<li>
<p>Check out the entire master branch (you can also check out individual files by passing the specific file name).  Below is the command for checking out the entire default branch.</p>

<div class="highlight highlight-bash"><pre>git checkout 
</pre></div>
</li>
<li>
<p>Add your application code to the respective directory.  For a new app, create the directories following the taxonomy tclapp/&lt;YOUR_COMPANY&gt;/&lt;YOUR_APP&gt; (for an example see tclapp/mycompany/myapp), including test code.  Note you can use your github account name in place of &lt;YOUR_COMPANY&gt; if you would like.</p>
<p>
For more information on creating application, refer to the following section</p>
<p></p>

<h4>
<a name="my-first-vivado-tcl-app" class="anchor" href="#my-first-vivado-tcl-app"><span class="octicon octicon-link"></span></a>My First Vivado Tcl App.</h4>
</li>
<li>
<p>Mark files for adding. Make sure you add all necessary files, including the tclIndex, pkgIndex.tcl, and package provider files  (3 in addition to the "normal" tcl source files.  The tclIndex and pkgIndex.tcl files are generated by Vivado - described later in the section for My First Vivado Tcl App. </p>

<div class="highlight highlight-bash"><pre><span class="nb">cd</span> ./XilinxTclStore
git add tclapp/&lt;YOUR_COMPANY&gt;/&lt;YOUR_APP&gt;
</pre></div>
</li>
<li>
<p>Commit to local repository</p>

<div class="highlight highlight-bash"><pre>git commit -m <span class="s2">"your description of the changes"</span>
</pre></div>
</li>
<li>
<p>Push to your cloned master &lt;USER&gt;/XilinxTclStore in Github</p>

<div class="highlight highlight-bash"><pre>git push origin
</pre></div>
</li>
<li>
<p>Send Pull Request.  Switch back to github.com in a web browser, and navigate to your repo
<a href="https://help.github.com/articles/creating-a-pull-request">https://help.github.com/articles/creating-a-pull-request</a>
Press "Pull Request" button right upper-ish </p>
<p>
Add any additiona note if you wish</p>
<p></p>
</li>
</ol><p>Done!</p>

<h2>
<a name="as-a-gate-keeper-app-owner" class="anchor" href="#as-a-gate-keeper-app-owner"><span class="octicon octicon-link"></span></a>As a Gate Keeper (app owner)</h2>

<p>config proxy (see section As a Contributor)</p>

<p>config &lt;USER&gt; (see section As a Contributor)</p>

<p>config &lt;USER&gt; email (see section As a Contributor)</p>

<p>config merge option</p>

<div class="highlight highlight-bash"><pre>git config --global merge.defaultToUpstream <span class="nb">true</span>
</pre></div>

<ol>
<li>
<p>Create a repository by cloning XilinxTclStore, skip to next step if repository already exists locally</p>

<div class="highlight highlight-bash"><pre>On Windows
git clone https://github.com/XilinxInc/XilinxTclStore.git
On Linux
git clone http://USER@github.com/XilinxInc/XilinxTclStore.git
</pre></div>
</li>
<li>
<p>Update local repo with github master</p>

<div class="highlight highlight-bash"><pre>git fetch
</pre></div>
</li>
<li>
<p>Merge any changes</p>

<div class="highlight highlight-bash"><pre>git merge --ff
</pre></div>
</li>
<li><p>Set up remote to point where the pull request is sent usually USER/USER if this has not been done yet</p></li>
</ol><div class="highlight highlight-bash"><pre>git remote add remote_name https://github.com/&lt;USER&gt;/XilinxTclStore.git
e.g.
git remote add raj https://github.com/rajklair/XilinxTclStore.git
</pre></div>

<ol>
<li>
<p>Update local repo with &lt;USER&gt; branch</p>

<div class="highlight highlight-bash"><pre>git fetch remote_name
</pre></div>
</li>
<li>
<p>Merge changes from &lt;USER&gt; branch.  Use "master" or the name of the branch if the user forked.</p>

<div class="highlight highlight-bash"><pre>git merge remote_name/remote_branch
e.g.
git merge raj/rajklair
</pre></div>
</li>
<li><p>Fix any merge conlicts</p></li>
<li>
<p>Add the changes and commit</p>

<div class="highlight highlight-bash"><pre>git add .
git commit -m <span class="s2">"update notes"</span>
</pre></div>
</li>
<li><p>Run tests and check content</p></li>
<li>
<p>Push to github or go to step 11</p>

<div class="highlight highlight-bash"><pre>git push origin master
</pre></div>

<p>geto Step 12</p>
</li>
<li>
<p>Go to Github.com
Pull Request from the &lt;USER&gt;.</p>
<p>
If everything is good, merge, add comments and close the pull request.</p>
<p>
If something is not good, add comments so the requester can make changes.</p>
<p>
If something is bad, add comments, reject it and close the pull request.</p>
<p>
<a href="https://help.github.com/articles/merging-a-pull-request">https://help.github.com/articles/merging-a-pull-request</a></p>
</li>
<li>
<p>Delete the local repository</p>

<div class="highlight highlight-bash"><pre>git branch -r -d remote_name/remote_branch
e.g.
git branch -r -d raj/rajklair
</pre></div>

<p>Or in browser, delete this branch after merging when prompted.</p>
</li>
</ol><p>Done</p>

<h2>
<a name="my-first-vivado-tcl-app-1" class="anchor" href="#my-first-vivado-tcl-app-1"><span class="octicon octicon-link"></span></a>My First Vivado Tcl App</h2>

<h3>
<a name="let-vivado-know-where-your-cloned-tcl-repository-is-located" class="anchor" href="#let-vivado-know-where-your-cloned-tcl-repository-is-located"><span class="octicon octicon-link"></span></a>Let Vivado know where your cloned Tcl repository is located</h3>

<p>Before you start Vivado, there is an environment variable to change the location of the default repository.  YOu need to change this to your local working directory to test the app and generate some needed files.  Set XILINX_TCLAPP_REPO to the location of your cloned repository</p>

<div class="highlight highlight-bash"><pre><span class="nb">export </span><span class="nv">XILINX_TCLAPP_REPO</span><span class="o">=</span>&lt;WORKING_DIR&gt;/XilinxTclStore
</pre></div>

<p>Some of the Tcl app related commmands in Vivado require a Tcl repo to be present so it is important the
env variable is set before you start Vivado.</p>

<h3>
<a name="fetch-and-merge-updates-to-your-cloned-repository" class="anchor" href="#fetch-and-merge-updates-to-your-cloned-repository"><span class="octicon octicon-link"></span></a>Fetch and merge updates to your cloned repository</h3>

<p>If you have already cloned the repository, then you may want to fetch and merge the latest updates into your clone.</p><p>
The lastest and greatest official apps are available in the "master" branch so this is where you want to merge into.</p><p></p>

<div class="highlight highlight-bash"><pre><span class="nb">cd </span>XilinxTclStore
git checkout master
git fetch
git merge
</pre></div>

<h3>
<a name="create-the-directory-structure" class="anchor" href="#create-the-directory-structure"><span class="octicon octicon-link"></span></a>Create the Directory Structure</h3>

<p>The directory structure should follow &lt;WORKING_DIR&gt;/tclapp/&lt;YOUR_COMPANY&gt;/&lt;YOUR_APP&gt;/...</p>

<div class="highlight highlight-bash"><pre>mkdir -p ./tclapp/mycompany/myapp
<span class="nb">cd</span> ./tclapp/mycompany/myapp
</pre></div>

<p>More directory and testing structure can be found in tclapp/README.</p>

<h3>
<a name="create-the-package-provider" class="anchor" href="#create-the-package-provider"><span class="octicon octicon-link"></span></a>Create the Package Provider</h3>

<p>Every app needs a tcl script that provides packaging information to Vivado.  This is called the package provider.  The name of the script can be whatever you like, but the contents of the file must be the same as published below.  We suggest a .tcl file with the same name as your app, &lt;YOUR_APP&gt;. See one of the existing apps for an example.</p>

<div class="highlight highlight-bash"><pre>vi ./myapp.tcl
</pre></div>

<p>Change the version and namespace to match your app:</p>

<div class="highlight highlight-tcl"><pre><span class="c"># tclapp/mycompany/myapp/myapp.tcl</span>
<span class="nb">package</span> require Tcl <span class="mf">8.5</span>

<span class="k">namespace</span> eval <span class="o">::</span>tclapp::mycompany::myapp <span class="k">{</span>

    <span class="c"># Allow Tcl to find tclIndex</span>
    <span class="k">variable</span> home <span class="k">[</span><span class="nb">file</span> join <span class="k">[</span><span class="nb">pwd</span><span class="k">]</span> <span class="k">[</span><span class="nb">file</span> dirname <span class="k">[</span><span class="nb">info</span> script<span class="k">]]]</span>
    <span class="k">if</span> <span class="k">{[</span><span class="nb">lsearch</span> <span class="o">-</span>exact <span class="nv">$::auto_path</span> <span class="nv">$home</span><span class="k">]</span> <span class="o">==</span> <span class="nv">-1</span><span class="k">}</span> <span class="k">{</span>
    <span class="nb">lappend</span> <span class="o">::</span>auto_path <span class="nv">$home</span>
    <span class="k">}</span>

<span class="k">}</span>
<span class="nb">package</span> provide <span class="o">::</span>tclapp::mycompany::myapp <span class="mf">1.0</span>
</pre></div>

<h3>
<a name="customize-the-app" class="anchor" href="#customize-the-app"><span class="octicon octicon-link"></span></a>Customize the App</h3>

<p>Your app scripts will not be able to have this same name, but could be placed inside of this package provider file.
If you already have the app created, then copy it into &lt;WORKING_DIR&gt;/tclapp/&lt;YOUR_COMPANY&gt;/&lt;YOUR_APP&gt;/.
If you are creating the app from scratch, then:</p>

<div class="highlight highlight-bash"><pre>vi ./myfile.tcl
</pre></div>

<p>You need to make sure of couple things:</p>

<ol>
<li>
<p>You must have all procs in namespaces, e.g.</p>

<div class="highlight highlight-tcl"><pre><span class="c"># tclapp/mycompany/myapp/myfile.tcl</span>
<span class="k">proc</span> <span class="o">::</span>tclapp::mycompany::myapp::myproc1 <span class="k">{</span><span class="nv">arg1</span> <span class="k">{</span><span class="nv">optional1</span> <span class="err">,</span><span class="k">}}</span> <span class="k">{</span>
<span class="nv">...</span>
<span class="k">}</span>
</pre></div>
</li>
<li>
<p>Add the commands that you would like to export to the top of each file.  It is important
that your are explicit about the commands, in other words, do <em>not</em> use wildcards.</p>

<div class="highlight highlight-tcl"><pre><span class="c"># tclapp/mycompany/myapp/myfile.tcl</span>
<span class="k">namespace</span> eval <span class="o">::</span>tclapp::mycompany::myapp <span class="k">{</span>
<span class="c"># Export procs that should be allowed to import into other namespaces</span>
<span class="k">namespace</span> export myproc1
<span class="k">}</span>
<span class="k">proc</span> <span class="o">::</span>tclapp::mycompany::myapp::myproc1 <span class="k">{</span><span class="nv">arg1</span> <span class="k">{</span><span class="nv">optional1</span> <span class="err">,</span><span class="k">}}</span> <span class="k">{</span>
<span class="nv">...</span>
<span class="k">}</span>
</pre></div>
</li>
<li>
<p>You <strong>must</strong> have 4 "meta-comments" which describe your procedure interfaces - inside of the procedures,
and each meta-comment <strong>must</strong> be seperated by new lines (without comments)</p>

<div class="highlight highlight-tcl"><pre><span class="c"># tclapp/mycompany/myapp/myfile.tcl</span>
<span class="k">namespace</span> eval <span class="o">::</span>tclapp::mycompany::myapp <span class="k">{</span>
<span class="c"># Export procs that should be allowed to import into other namespaces</span>
<span class="k">namespace</span> export myproc1
<span class="k">}</span>
<span class="k">proc</span> <span class="o">::</span>tclapp::xilinx::test::myproc1 <span class="k">{</span><span class="nv">arg1</span> <span class="k">{</span><span class="nv">optional1</span> <span class="err">,</span><span class="k">}}</span> <span class="k">{</span>

<span class="c"># Summary: A one line summary of what this proc does</span>

<span class="c"># Argument Usage:</span>
<span class="c"># -arg1 &lt;arg&gt; : A one line summary of this argument which takes a value indicated by &lt;arg&gt;.</span>
<span class="c"># [-optional1 &lt;arg&gt; = &lt;opt1_default&gt;] : A one line summary of an optional argument that takes a value and which has a default</span>
<span class="c"># [-optional2] : A one line summary of an optional arg that does not take a value (aka a flag)</span>

<span class="c"># Return Value:</span>
<span class="c"># TCL_OK is returned with result set to a string</span>

<span class="c"># Categories: xilinxtclstore, projutils</span>

<span class="nv">...</span>
<span class="k">}</span>
</pre></div>

<p>Each of these meta-comments is interpreted by Vivado at run-time. It is critical that they be present and correct in your app
or it may not function correctly. The following is a description of each meta-comment.</p>
</li>
</ol><h4>
<a name="summary" class="anchor" href="#summary"><span class="octicon octicon-link"></span></a>Summary</h4>

<p>The text following "Summary:" should be a brief, one-line description of your app.</p>

<h4>
<a name="argument-usage" class="anchor" href="#argument-usage"><span class="octicon octicon-link"></span></a>Argument Usage</h4>

<p>This is the most complex of the meta-comments. As shown in the above example, there should be one line for each mandatory or
optional arg supported by your app. Optional args should be enclosed within []. Args which should be accompanied by a
value <strong>must</strong> be followed by the literal text &lt;, "arg", and &gt;, indicating to the USER where the value should be placed. The
summary should explain what are the valid values that a USER might use.
You can also specify a default value, which is a value which will be assumed if the USER does not specify the given optional
arg. You can also have optional args that do not take any value (these are often referred to as "flags"). For a flag,
it's presence on the command line implies a value of true, indicating that some optional action should be take by
the app. An exception to this rule is if the name of the flag is prefixed with "no_" (for example, -no_cleanup), in which case
a value of false is implied, indicating that the app will not take some action which by default it normally performs.</p>

<p>You can also specify positional args. A positional arg is for which just a value is specified
and that has no corresponding flag (e.g. -arg1).</p>

<p>Here is a more concrete example:</p>

<div class="highlight highlight-tcl"><pre>        <span class="c"># Argument Usage:</span>
        <span class="c"># file: Name of  file to generate</span>
        <span class="c"># -owner &lt;arg&gt;: USERname of the owner of the file to be generated.</span>
        <span class="c"># [-date &lt;arg&gt; = &lt;todays_date&gt;]: The date to use in yyyy/mm/dd format, will default to today's date if not specified.</span>
</pre></div>

<p>This example app has one mandatory positional arg, which is the name of a file it will generate. It also has a mandatory
flag -owner, and an optional arg -date, which has a default value. Assuming this app was called "touch", an example usage might be:</p>

<p>touch /home/joe_USER/myfile -owner root</p>

<p>Use of this command would result in the creation of a file named /home/joe_USER/myfile, owned by root, and with
a file creation date of today.</p>

<h4>
<a name="return-value" class="anchor" href="#return-value"><span class="octicon octicon-link"></span></a>Return Value</h4>

<p>Use this meta-comment to specify the possible return values for your app.</p>

<h4>
<a name="categories" class="anchor" href="#categories"><span class="octicon octicon-link"></span></a>Categories</h4>

<p>Use this meta-comment to specify which categories in the Vivado help system your app should be listed. "Categories:"
should be followed by a comma-separated list. By convention, the first category listed should always be "xilinxtclstore".
Any additional categories are up to you as the app developer.</p>

<h3>
<a name="create-the-package-index-and-tcl-index" class="anchor" href="#create-the-package-index-and-tcl-index"><span class="octicon octicon-link"></span></a>Create the Package Index and Tcl Index</h3>

<div class="highlight highlight-bash"><pre><span class="nb">cd</span> ~/XilinxTclStore/tclapp/mycompany/myapp
vivado -mode tcl -nolog -nojournal
</pre></div>

<div class="highlight highlight-tcl"><pre><span class="nb">pkg_mkIndex</span> .
<span class="nv">auto_mkindex</span> .
</pre></div>

<h3>
<a name="running-the-linter" class="anchor" href="#running-the-linter"><span class="octicon octicon-link"></span></a>Running the Linter</h3>

<p>If you are not already in Vivado:</p>

<div class="highlight highlight-bash"><pre>vivado -mode tcl
</pre></div>

<p>There should be a lint_files command available at this point:</p>

<div class="highlight highlight-tcl"><pre><span class="nv">Vivado</span><span class="o">%</span> lint_files <span class="k">[</span><span class="nb">glob</span> XilinxTclStore<span class="o">/</span>tclapp<span class="o">/</span>mycompany<span class="o">/</span>myapp<span class="o">/*</span>.tcl<span class="k">]</span>
</pre></div>

<p>Correct anything the linter identifies as a problem.</p>

<h3>
<a name="check-the-app-before-you-deploy" class="anchor" href="#check-the-app-before-you-deploy"><span class="octicon octicon-link"></span></a>Check the App before you Deploy</h3>

<ol>
<li>Set XILINX_TCLAPP_REPO to point where the local XilinxTclStore is
<code>bash
export XILINX_TCLAPP_REPO=&lt;WORKING_DIR&gt;/XilinxTclStore
</code>
or just the path
<code>bash
export XILINX_TCLAPP_REPO=&lt;WORKING_DIR&gt;
</code>
Run Vivado
<code>bash
vivado -mode tcl
</code>
</li>
</ol><p>When the env variable is set, Vivado automatically adds the location of the repository to the
auto_load path in Tcl.</p>

<ol>
<li>Start testing<p></p>
</li>
</ol><p>Require the package that was provided by the app</p>

<div class="highlight highlight-tcl"><pre><span class="nv">vivado</span><span class="o">%</span> package require <span class="o">::</span>tclapp::mycompany::myapp
</pre></div>

<p>Optionally import an exported proc</p>

<div class="highlight highlight-tcl"><pre><span class="k">namespace</span> import <span class="o">::</span>tclapp::mycompany::myapp::<span class="o">*</span>
<span class="nv">myproc1</span>
<span class="nv">...</span>
</pre></div>

<h3>
<a name="setting-up-a-per-repository-user-name-and-email" class="anchor" href="#setting-up-a-per-repository-user-name-and-email"><span class="octicon octicon-link"></span></a>Setting up a per repository User Name and Email</h3>

<div class="highlight highlight-bash"><pre><span class="nb">cd</span> ~/XilinxTclStore
git config USER.name “johnd”
git config USER.email “johnd@mycompany.com”
</pre></div>

<h3>
<a name="commit-changes" class="anchor" href="#commit-changes"><span class="octicon octicon-link"></span></a>Commit Changes</h3>

<p>Make sure you commit your &lt;USER&gt; branch.</p>

<div class="highlight highlight-bash"><pre><span class="nb">cd</span> ~/XilinxTclStore
git checkout myorg-johnd
git add .
git status
git commit -m <span class="s2">"created myapp for mycompany"</span>
git push origin mycompany
</pre></div>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Xilinxtclstore maintained by <a href="https://github.com/Xilinx">Xilinx</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
